---
import { getCollection } from "astro:content";
import type { CollectionEntry } from "astro:content";
import BlogPostPage from "../../../components/pages/BlogPostPage.astro";
import { languages } from "../../../i18n/utils";
import type { Language } from "../../../i18n/utils";

export async function getStaticPaths() {
  const paths = [];

  // Only generate paths for non-default locales when prefixDefaultLocale is false
  for (const locale of languages.filter(lang => lang !== 'en')) {
    const blogEntries = await getCollection("blog", ({ id }) =>
      id.startsWith(`${locale}/`)
    );
    const localePaths = blogEntries.map((entry) => ({
      params: {
        locale,
        slug: entry.slug.replace(`${locale}/`, ""),
      },
      props: { entry, locale },
    }));
    paths.push(...localePaths);
  }

  return paths;
}

interface Props {
  entry: CollectionEntry<"blog">;
  locale: Language;
}

const { entry, locale } = Astro.props;
---

<BlogPostPage entry={entry} locale={locale} />
