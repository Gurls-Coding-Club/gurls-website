---
/**
 * NavigationDropdown component - A dropdown menu with semantic HTML and accessibility features
 *
 * This component renders a dropdown navigation menu with keyboard navigation support,
 * ARIA attributes, and proper focus management.
 */
import { Icon } from "astro-icon/components";

export interface DropdownItem {
  /** The URL to link to */
  href: string;
  /** The text to display for the link */
  label: string;
}

interface Props {
  /** The label for the dropdown button */
  label: string;
  /** Array of dropdown items */
  items: DropdownItem[];
  /** Additional CSS classes for the dropdown wrapper */
  className?: string;
}

const { label, items, className = "" } = Astro.props;
---

<div class={`relative group ${className}`}>
  <button
    class="flex items-center gap-1 hover:text-accent transition-colors"
    aria-haspopup="true"
    aria-expanded="false"
  >
    {label}
    <Icon name="lucide:chevron-down" class="w-4 h-4" aria-hidden="true" />
  </button>
  <div
    class="absolute top-full left-0 mt-2 w-48 bg-white text-primary rounded-lg shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200"
    role="menu"
  >
    {
      items.map((item, index) => {
        const isFirst = index === 0;
        const isLast = index === items.length - 1;

        const itemClasses = [
          "block px-4 py-2 hover:bg-gray-100 transition-colors",
          isFirst && "rounded-t-lg",
          isLast && "rounded-b-lg",
        ]
          .filter(Boolean)
          .join(" ");

        return (
          <a href={item.href} class={itemClasses} role="menuitem">
            {item.label}
          </a>
        );
      })
    }
  </div>
</div>

<script>
  // Enhanced keyboard navigation and accessibility for dropdowns
  document.addEventListener("DOMContentLoaded", () => {
    const dropdownButtons = document.querySelectorAll(
      'button[aria-haspopup="true"]'
    ) as NodeListOf<HTMLButtonElement>;

    dropdownButtons.forEach((button: HTMLButtonElement) => {
      const dropdown = button.nextElementSibling as HTMLElement;

      // Handle keyboard navigation
      button.addEventListener("keydown", (e: KeyboardEvent) => {
        if (e.key === "Enter" || e.key === " ") {
          e.preventDefault();
          const isExpanded = button.getAttribute("aria-expanded") === "true";
          button.setAttribute("aria-expanded", String(!isExpanded));
        } else if (e.key === "Escape") {
          button.setAttribute("aria-expanded", "false");
          button.focus();
        }
      });

      // Update aria-expanded on hover (for mouse users)
      button.parentElement?.addEventListener("mouseenter", () => {
        button.setAttribute("aria-expanded", "true");
      });

      button.parentElement?.addEventListener("mouseleave", () => {
        button.setAttribute("aria-expanded", "false");
      });

      // Close dropdown when clicking outside
      document.addEventListener("click", (e) => {
        if (!button.parentElement?.contains(e.target as Node)) {
          button.setAttribute("aria-expanded", "false");
        }
      });

      // Arrow key navigation within dropdown
      dropdown?.addEventListener("keydown", (e: KeyboardEvent) => {
        const menuItems = Array.from(
          dropdown.querySelectorAll('[role="menuitem"]')
        ) as HTMLElement[];
        const currentIndex = menuItems.indexOf(
          document.activeElement as HTMLElement
        );

        if (e.key === "ArrowDown") {
          e.preventDefault();
          const nextIndex = (currentIndex + 1) % menuItems.length;
          menuItems[nextIndex]?.focus();
        } else if (e.key === "ArrowUp") {
          e.preventDefault();
          const prevIndex =
            currentIndex > 0 ? currentIndex - 1 : menuItems.length - 1;
          menuItems[prevIndex]?.focus();
        } else if (e.key === "Escape") {
          e.preventDefault();
          button.setAttribute("aria-expanded", "false");
          button?.focus();
        }
      });
    });
  });
</script>
