---
import {
  getLangFromUrl,
  useTranslations,
  getLocalizedPath,
} from "../i18n/utils";
import Link from "./Link.astro";
import { Icon } from "astro-icon/components";
import { siteConfig, socialMediaArray } from "../config/site";

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

// Map social platform to icon name
const socialIcons = {
  instagram: "lucide:instagram",
  discord: "simple-icons:discord",
  linkedin: "lucide:linkedin",
} as const;
---

<footer class="bg-primary text-primary-text pt-16 pb-8">
  <div class="container mx-auto px-4">
    <div class="grid grid-cols-1 md:grid-cols-3 gap-12 mb-12">
      <!-- Contact Info -->
      <div>
        <h3 class="text-2xl font-bold mb-4">{t("footer.stayInTouch")}</h3>
        <div class="mb-4">
          <p class="opacity-90">
            {siteConfig.name}<br />
            {siteConfig.contact.address.street}<br />
            {siteConfig.contact.address.postalCode} {
              lang === "de"
                ? siteConfig.contact.address.cityDe
                : siteConfig.contact.address.city
            }, {
              lang === "de"
                ? siteConfig.contact.address.countryDe
                : siteConfig.contact.address.country
            }
          </p>
        </div>
        <div class="flex gap-3 mt-6">
          {
            socialMediaArray.map((social) => (
              <Link
                variant="secondary"
                href={social.url}
                className="w-5 h-5"
                aria-label={social.name}
              >
                <Icon
                  name={socialIcons[social.platform]}
                  class="w-6 h-6"
                  aria-hidden="true"
                />
              </Link>
            ))
          }
        </div>
      </div>

      <!-- Get Involved -->
      <div>
        <h3 class="text-2xl font-bold mb-4">{t("footer.getInvolved")}</h3>
        <nav class="flex flex-col gap-2">
          <a
            href={getLocalizedPath(lang, "/join")}
            class="opacity-90 hover:opacity-100 hover:text-blue-light transition-colors"
          >
            {t("nav.joinUs")}
          </a>
          <a
            href={getLocalizedPath(lang, "/volunteer")}
            class="opacity-90 hover:opacity-100 hover:text-blue-light transition-colors"
          >
            {t("nav.volunteer")}
          </a>
          <a
            href={getLocalizedPath(lang, "/sponsor")}
            class="opacity-90 hover:opacity-100 hover:text-blue-light transition-colors"
          >
            {t("nav.sponsor")}
          </a>
          <a
            href={getLocalizedPath(lang, "/donate")}
            class="opacity-90 hover:opacity-100 hover:text-blue-light transition-colors"
          >
            {t("nav.donate")}
          </a>
        </nav>
      </div>

      <!-- Support -->
      <div>
        <h3 class="text-2xl font-bold mb-4">{t("footer.supportInitiative")}</h3>
        <div
          class="bg-white/10 backdrop-blur-sm rounded-lg p-4 text-sm relative"
        >
          <button
            id="copy-bank-info"
            class="absolute top-1 right-1 p-2 hover:bg-white/20 rounded transition-colors"
            aria-label="Copy bank information"
            title="Copy bank information"
          >
            <Icon name="lucide:copy" class="w-5 h-5" aria-hidden="true" />
          </button>
          <ul>
            <li class="mb-1">
              {t("footer.bankingInfo.accountHolder")}: {
                siteConfig.banking.accountHolder
              }
            </li>
            <li class="mb-1 font-mono">IBAN: {siteConfig.banking.iban}</li>
            <li class="mb-1 font-mono">BIC: {siteConfig.banking.bic}</li>
            <li class="mb-1">Bank: {siteConfig.banking.bank}</li>
            <li class="mt-1">
              {t("footer.bankingInfo.reference")}: {
                siteConfig.banking.reference
              }
            </li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Sponsors -->
    <div class="border-t border-white/20 pt-8 mb-8">
      <h3 class="text-xl font-bold text-center mb-6">{t("footer.sponsors")}</h3>
      <div class="flex flex-wrap justify-center items-center gap-8">
        <!-- Placeholder for sponsor logos -->
        {
          siteConfig.sponsors.map((sponsor) => (
            <div class="bg-white/10 backdrop-blur-sm rounded-lg px-8 py-4">
              <p class="text-sm opacity-75">{sponsor.name}</p>
            </div>
          ))
        }
      </div>
    </div>

    <!-- Copyright -->
    <div class="border-t border-white/20 pt-6 text-center text-sm opacity-75">
      <p class="mb-3">{t("footer.copyright")}</p>
      <div class="flex flex-wrap justify-center gap-4">
        <a
          href={getLocalizedPath(lang, "/imprint")}
          class="hover:text-blue-light transition-colors"
        >
          {t("pages.imprint.title")}
        </a>
        <span>|</span>
        <a
          href={getLocalizedPath(lang, "/contact")}
          class="hover:text-blue-light transition-colors"
        >
          {t("nav.contact")}
        </a>
      </div>
    </div>
  </div>
</footer>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const copyButton = document.getElementById("copy-bank-info");
    if (!copyButton) return;

    copyButton.addEventListener("click", async () => {
      // Extract bank information from the list
      const listItems = copyButton.closest(".relative")?.querySelectorAll("li");
      if (!listItems) return;

      const lines: string[] = [];
      listItems.forEach((item) => {
        const text = item.textContent?.trim();
        if (text) lines.push(text);
      });

      const textToCopy = lines.join("\n");

      try {
        await navigator.clipboard.writeText(textToCopy);

        // Visual feedback
        const icon = copyButton.querySelector("[data-icon]") as HTMLElement;
        const originalIcon = copyButton.innerHTML;

        // Change to check icon
        copyButton.innerHTML =
          '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>';
        copyButton.classList.add("bg-white/20");

        // Reset after 2 seconds
        setTimeout(() => {
          copyButton.innerHTML = originalIcon;
          copyButton.classList.remove("bg-white/20");
        }, 2000);
      } catch (err) {
        console.error("Failed to copy bank information:", err);
      }
    });
  });
</script>
